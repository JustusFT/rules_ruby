ruby_library(
  name = "<%= gem.name %>",
  srcs = glob(
    include = [
      <% gem.require_paths.each do |lib|  %>
      "<%= gem_path %>/<%= lib %>/**/*.rb",
      <% end %>
    ],
    exclude = <%= exclude_array %>,
  ),
  deps = <%= deps %>,
  rubyopt = ["-r${RUNFILES_DIR}/<%= repo_name %>/lib/bundler/setup.rb"],
)

<%  unless gem&.files&.empty?  %>
# This version of the ruby_library uses gem.files as sources
# and is experimental.
ruby_library(
  name = "<%= gem.name %>-files",
  srcs = glob(
    include = <%= gem.files %>,
    exclude = <%= exclude_array %>,
  ),
  includes = <%= gem.require_paths %>,
  deps = <%= deps %>,
  rubyopt = ["-r${RUNFILES_DIR}/<%= repo_name %>/lib/bundler/setup.rb"],
)
<%  end  %>

<%  unless gem.executables&.empty?  %>
  <%  gem.executables.each do |executable|  %>

ruby_binary(
  name = "<%= gem.name %><%= executable %>",
  srcs = glob(
    include = <%= gem.executables %>,
    exclude = <%= exclude_array %>,
  ),
  deps = <%= deps %> + [ ":<%= gem.name %>" ],
  rubyopt = ["-r${RUNFILES_DIR}/<%= repo_name %>/lib/bundler/setup.rb"],
)

  <%  end %>
<%  end %>